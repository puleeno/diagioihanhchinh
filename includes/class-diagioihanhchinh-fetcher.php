<?php
use PhpOffice\PhpSpreadsheet\Spreadsheet;
use PhpOffice\PhpSpreadsheet\Reader\Xls;
use PhpOffice\PhpSpreadsheet\IOFactory;

class Diagioihanhchinh_Fetcher {
	protected $spreadsheet;

	protected function build_form_data($html) {
		$form_data = array(
			'__EVENTTARGET' => 'ctl00$PlaceHolderMain$btnExcel',
			'__EVENTARGUMENT' => 'Click',
			'__VIEWSTATE' => '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ZWIuQVNQeEdyaWRWaWV3LnY5LjEsIFZlcnNpb249OS4xLjMuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj01Mzc3YzhlM2I3MmI0MDczZBgBBR5fX0NvbnRyb2xzUmVxdWlyZVBvc3RCYWNrS2V5X18WDAUgY3RsMDAkUGxhY2VIb2xkZXJNYWluJGNtYkNhcCREREQFIWN0bDAwJFBsYWNlSG9sZGVyTWFpbiR0eHROZ2F5JERERAUtY3RsMDAkUGxhY2VIb2xkZXJNYWluJHR4dE5nYXkkREREJGN0bDE1JGN0bDA1BSFjdGwwMCRQbGFjZUhvbGRlck1haW4kQVNQeEJ1dHRvbjEFHmN0bDAwJFBsYWNlSG9sZGVyTWFpbiRidG5FeGNlbAUbY3RsMDAkUGxhY2VIb2xkZXJNYWluJGdyaWQwBRtjdGwwMCRQbGFjZUhvbGRlck1haW4kZ3JpZDEFG2N0bDAwJFBsYWNlSG9sZGVyTWFpbiRncmlkMgUbY3RsMDAkUGxhY2VIb2xkZXJNYWluJGdyaWQzBSNjdGwwMCRQbGFjZUhvbGRlck1haW4kQVNQeEdyaWRWaWV3NAUjY3RsMDAkUGxhY2VIb2xkZXJNYWluJEFTUHhHcmlkVmlldzUFI2N0bDAwJFBsYWNlSG9sZGVyTWFpbiRBU1B4R3JpZFZpZXc2craPXDLnT1zpz4Z2PLtalSQipxk=',
			'__VIEWSTATEGENERATOR' => 'E8CD93C2',
			'__EVENTVALIDATION' => '/wEWEALO7dyZBQLJ/qHHBQKAqdjcBQLJ/qHHBQKol6OxCQKWz4y8BgKqqunuCALvvYbMBALzmOavAwLb4b/YBQLA+KHDCwKlj4SuAQKKpuaYBwL9gtWxAQKY7PLGCwKz1ZDcBY+W/SZQZzsvy2GA8HNIQxtE0fLU',
			'ctl00_PlaceHolderMain_cmbCap_VI' => '1',
			'ctl00$PlaceHolderMain$cmbCap' => 'Tỉnh',
			'ctl00_PlaceHolderMain_cmbCap_DDDWS' => '0:0:-1:0:0:0:0:0:',
			'ctl00_PlaceHolderMain_cmbCap_DDD_LDeletedItems' => '',
			'ctl00_PlaceHolderMain_cmbCap_DDD_LInsertedItems' => '',
			'ctl00_PlaceHolderMain_cmbCap_DDD_LCustomCallback' => '',
			'ctl00$PlaceHolderMain$cmbCap$DDD$L' => '1',
			'ctl00$PlaceHolderMain$cmbCap$DDD$L$CVS' => '',
			'ctl00$PlaceHolderMain$cmbCap$CVS' => '',
			'ctl00_PlaceHolderMain_txtNgay_Raw' => '1599004800000',
			'ctl00$PlaceHolderMain$txtNgay' => '02/09/2020',
			'ctl00_PlaceHolderMain_txtNgay_DDDWS' => '0:0:-1:0:0:0:0:0:',
			'ctl00_PlaceHolderMain_txtNgay_DDD_C_FNPWS' => '0:0:-1:0:0:0:0:0:',
			'ctl00$PlaceHolderMain$txtNgay$DDD$C' => '09/02/2020:09/02/2020',
			'ctl00$PlaceHolderMain$txtNgay$DDD$C$CVS' => '',
			'ctl00$PlaceHolderMain$txtNgay$CVS' => '',
			'ctl00$PlaceHolderMain$txtMa' => '',
			'ctl00$PlaceHolderMain$txtMa$CVS' => '',
			'ctl00$PlaceHolderMain$txtTen' => '',
			'ctl00$PlaceHolderMain$txtTen$CVS' => '',
			'ctl00$PlaceHolderMain$check' => 'C', // U chỉ tải tỉnh, C tải tất cả tỉnh, quận, huyện
			'ctl00$PlaceHolderMain$check2' => 'N',
			'ctl00$PlaceHolderMain$check$CVS' => '',
			'ctl00$PlaceHolderMain$check2$CVS' => '',
			'ctl00$PlaceHolderMain$grid0$DXSelInput' => '',
			'ctl00$PlaceHolderMain$grid0$DXFocusedRowInput' => '-1',
			'ctl00$PlaceHolderMain$grid0$CallbackState' => '/wEWBB4ERGF0YQUsQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQWNCQXdjQUJ3QT0eBVN0YXRlBaABQnhRSEFBSUJCd0VDQVFjQ0FnRUhBd0lCQndRQ0FRY0ZBZ0VIQmdJQkJ3Y0NBUWNJQWdBSENBSUFCd2dDQUFjSUFnQUhDQUlBQndnQ0FBY0lBZ0FIQ0FJQUJ3Z0NBQWNJQWdBSENBSUFCd2dDQUFjQUJ3QUhBQWNBQWdFRy8vOEpBZ0pKUkFrQ0FBSUFBd2NFQWdBSEFBSUJCd0FDQVFjQQ==',
			'ctl00$PlaceHolderMain$grid1$DXSelInput' => '',
			'ctl00$PlaceHolderMain$grid1$DXFocusedRowInput' => '0',
			'ctl00$PlaceHolderMain$grid1$CallbackState' => '/wEWBB4ERGF0YQXIMEFBQUFBRDhBQUFBQUFBQUFQd0FBQUFBUEFBQUFDMGxFWDNCeWIzWnBibU5sQzBsRVgzQnliM1pwYm1ObEJRQUFDRkJ5YjNacGJtTmxDRkJ5YjNacGJtTmxCd0FBQjA1aGJXVmZWbTRIVG1GdFpWOVdiZ2NBQUFoT1lXMWxYMFZ1WndoT1lXMWxYMFZ1WndjQUFBaFVlWEJsVG1GdFpRbFVlWEJsSUU1aGJXVUhBQUFFVG05MFpRUk9iM1JsQndBQUNFUmxZMmx6YVc5dUNFUmxZMmx6YVc5dUJ3QUFDVlZ5WW1GdVRtRnRaUXBWY21KaGJpQk9ZVzFsQndBQUNFRnlaV0ZPWVcxbENVRnlaV0VnVG1GdFpRY0FBQWhFWVhSbFJuSnZiUWxFWVhSbElFWnliMjBJQUFBR1JHRjBaVlJ2QjBSaGRHVWdWRzhJQUFBSVJHbGxibFJwWTJnSlJHbGxiaUJVYVdOb0JRQUFDRkJ2YzJsMGFXOXVDRkJ2YzJsMGFXOXVCd0FBQlVSaGJsTnZCa1JoYmlCVGJ3TUFBQXhFWldOcGMybHZia1JoZEdVTlJHVmphWE5wYjI0Z1JHRjBaUWdBQUFBQUFBQUhBUU1IUHdjQUJ3QUhBQWIvL3dVSEFRY0NBakF4QndJV1ZHakRvRzVvSUhCbzRidVJJRWpEb0NCTzRidVphUXdIQWhsVWFNT2dibWdnY0dqaHU1RWdWSEoxYm1jZ3hyREdvVzVuQndJYlU4T2hjQ0J1YU9HNnJYQWdWT0c3aVc1b0lFakRvQ0JVdzZKNURBd01DQUlFQUlEcXJJREJ5Z2dNREF3TURBY0FCd0FHLy84RkJ3SUhBZ0l3TWdjQ0VGVGh1NGx1YUNCSXc2QWdSMmxoYm1jTUJ3SUdWT0c3aVc1b0RBd01EQWdDQkFEQUxWSk1MTVlJREF3TURBd0hBQWNBQnYvL0JRY0RCd0lDTURRSEFoRlU0YnVKYm1nZ1EyRnZJRUxodXJGdVp3d0hBZ1pVNGJ1SmJtZ01EQXdNQ0FJRUFNQXRVa3dzeGdnTURBd01EQWNBQndBRy8vOEZCd1FIQWdJd05nY0NFbFRodTRsdWFDQkM0YnF2WXlCTDRicWhiZ3dIQWdaVTRidUpibWdNREF3TUNBSUVBTUF0VWt3c3hnZ01EQXdNREFjQUJ3QUcvLzhGQndVSEFnSXdPQWNDRTFUaHU0bHVhQ0JVZFhuRHFtNGdVWFZoYm1jTUJ3SUdWT0c3aVc1b0RBd01EQWdDQkFEQUxWSk1MTVlJREF3TURBd0hBQWNBQnYvL0JRY0dCd0lDTVRBSEFnOVU0YnVKYm1nZ1RNT2dieUJEWVdrTUJ3SUdWT0c3aVc1b0RBd01EQWdDQkFEQUxWSk1MTVlJREF3TURBd0hBQWNBQnYvL0JRY0hCd0lDTVRFSEFoUlU0YnVKYm1nZ3hKQnA0YnVIYmlCQ2FjT3FiZ3dIQWdaVTRidUpibWdNREF3TUNBSUVBTUF0VWt3c3hnZ01EQXdNREFjQUJ3QUcvLzhGQndnSEFnSXhNZ2NDRUZUaHU0bHVhQ0JNWVdrZ1EyakRvblVNQndJR1ZPRzdpVzVvREF3TURBZ0NCQURBTFZKTUxNWUlEQXdNREF3SEFBY0FCdi8vQlFjSkJ3SUNNVFFIQWc1VTRidUpibWdnVThhaGJpQk1ZUXdIQWdaVTRidUpibWdNREF3TUNBSUVBTUF0VWt3c3hnZ01EQXdNREFjQUJ3QUcvLzhGQndvSEFnSXhOUWNDRUZUaHU0bHVhQ0JadzZwdUlFTERvV2tNQndJR1ZPRzdpVzVvREF3TURBZ0NCQURBTFZKTUxNWUlEQXdNREF3SEFBY0FCdi8vQlFjTEJ3SUNNVGNIQWhGVTRidUpibWdnU0cvRG9DQkN3Nnh1YUF3SEFnWlU0YnVKYm1nTURBd01DQUlFQU1BdFVrd3N4Z2dNREF3TURBY0FCd0FHLy84RkJ3d0hBZ0l4T1FjQ0ZGVGh1NGx1YUNCVWFNT2hhU0JPWjNWNXc2cHVEQWNDQmxUaHU0bHVhQXdNREF3SUFnUUF3QzFTVEN6R0NBd01EQXdNQndBSEFBYi8vd1VIRFFjQ0FqSXdCd0lTVk9HN2lXNW9JRXpodXFGdVp5QlR4cUZ1REFjQ0JsVGh1NGx1YUF3TURBd0lBZ1FBd0MxU1RDekdDQXdNREF3TUJ3QUhBQWIvL3dVSERnY0NBakl5QndJVFZPRzdpVzVvSUZGMTRicWpibWNnVG1sdWFBd0hBZ1pVNGJ1SmJtZ01EQXdNQ0FJRUFNQXRVa3dzeGdnTURBd01EQWNBQndBRy8vOEZCdzhIQWdJeU5BY0NFbFRodTRsdWFDQkM0YnF2WXlCSGFXRnVad3dIQWdaVTRidUpibWdNREF3TUNBSUVBTUF0VWt3c3hnZ01EQXdNREFjQUJ3QUcvLzhGQnhBSEFnSXlOUWNDRVZUaHU0bHVhQ0JRYU1PNklGUm80YnVOREFjQ0JsVGh1NGx1YUF3TURBd0lBZ1FBd0MxU1RDekdDQXdNREF3TUJ3QUhBQWIvL3dVSEVRY0NBakkyQndJU1ZPRzdpVzVvSUZiRXFXNW9JRkJvdzdwakRBY0NCbFRodTRsdWFBd01EQXdJQWdRQXdDMVNUQ3pHQ0F3TURBd01Cd0FIQUFiLy93VUhFZ2NDQWpJM0J3SVJWT0c3aVc1b0lFTGh1cTlqSUU1cGJtZ01Cd0lHVk9HN2lXNW9EQXdNREFnQ0JBREFMVkpNTE1ZSURBd01EQXdIQUFjQUJ2Ly9CUWNVQndJQ016QUhBaFJVNGJ1SmJtZ2dTT0c2bzJrZ1JNYXd4cUZ1Wnd3SEFnWlU0YnVKYm1nTURBd01DQUlFQU1BdFVrd3N4Z2dNREF3TURBY0FCd0FHLy84RkJ4VUhBZ0l6TVFjQ0dWUm93NkJ1YUNCd2FPRzdrU0JJNGJxamFTQlFhTU95Ym1jTUJ3SVpWR2pEb0c1b0lIQm80YnVSSUZSeWRXNW5JTWF3eHFGdVp3d01EQXdJQWdRQXdDMVNUQ3pHQ0F3TURBd01Cd0FIQUFiLy93VUhGZ2NDQWpNekJ3SVJWT0c3aVc1b0lFakdzRzVuSUZuRHFtNE1Cd0lHVk9HN2lXNW9EQXdNREFnQ0JBREFMVkpNTE1ZSURBd01EQXdIQUFjQUJ2Ly9CUWNYQndJQ016UUhBaEpVNGJ1SmJtZ2dWR2pEb1drZ1FzT3NibWdNQndJR1ZPRzdpVzVvREF3TURBZ0NCQURBTFZKTUxNWUlEQXdNREF3SEFBY0FCdi8vQlFjWUJ3SUNNelVIQWc1VTRidUpibWdnU01PZ0lFNWhiUXdIQWdaVTRidUpibWdNREF3TUNBSUVBTUF0VWt3c3hnZ01EQXdNREFjQUJ3QUcvLzhGQnhrSEFnSXpOZ2NDRWxUaHU0bHVhQ0JPWVcwZ3hKRGh1NHR1YUF3SEFnWlU0YnVKYm1nTURBd01DQUlFQU1BdFVrd3N4Z2dNREF3TURBY0FCd0FHLy84RkJ4b0hBZ0l6TndjQ0VWVGh1NGx1YUNCT2FXNW9JRUxEckc1b0RBY0NCbFRodTRsdWFBd01EQXdJQWdRQXdDMVNUQ3pHQ0F3TURBd01Cd0FIQUFiLy93VUhHd2NDQWpNNEJ3SVJWT0c3aVc1b0lGUm9ZVzVvSUVqRHMyRU1Cd0lHVk9HN2lXNW9Cd0lBREF3TUNBSUVBTUF0VWt3c3hnZ01EQXdNREFjQUJ3QUcvLzhGQnh3SEFnSTBNQWNDRUZUaHU0bHVhQ0JPWjJqaHU0Y2dRVzRNQndJR1ZPRzdpVzVvREF3TURBZ0NCQURBTFZKTUxNWUlEQXdNREF3SEFBY0FCdi8vQlFjZEJ3SUNORElIQWhCVTRidUpibWdnU01PZ0lGVEVxVzVvREFjQ0JsVGh1NGx1YUF3TURBd0lBZ1FBd0MxU1RDekdDQXdNREF3TUJ3QUhBQWIvL3dVSEhnY0NBalEwQndJVVZPRzdpVzVvSUZGMTRicWpibWNnUXNPc2JtZ01Cd0lHVk9HN2lXNW9EQXdNREFnQ0JBREFMVkpNTE1ZSURBd01EQXdIQUFjQUJ2Ly9CUWNmQndJQ05EVUhBaFJVNGJ1SmJtZ2dVWFhodXFOdVp5QlVjdUc3aXd3SEFnWlU0YnVKYm1nTURBd01DQUlFQU1BdFVrd3N4Z2dNREF3TURBY0FCd0FHLy84RkJ5QUhBZ0kwTmdjQ0dsVGh1NGx1YUNCVWFPRzdxMkVnVkdocHc2cHVJRWgxNGJxL0RBY0NCbFRodTRsdWFBd01EQXdJQWdRQXdDMVNUQ3pHQ0F3TURBd01Cd0FIQUFiLy93VUhJUWNDQWpRNEJ3SVlWR2pEb0c1b0lIQm80YnVSSU1TUXc2QWdUdUc2dFc1bkRBY0NHVlJvdzZCdWFDQndhT0c3a1NCVWNuVnVaeURHc01haGJtY01EQXdNQ0FJRUFNQXRVa3dzeGdnTURBd01EQWNBQndBRy8vOEZCeUlIQWdJME9RY0NFbFRodTRsdWFDQlJkZUc2bzI1bklFNWhiUXdIQWdaVTRidUpibWdNREF3TUNBSUVBTUF0VWt3c3hnZ01EQXdNREFjQUJ3QUcvLzhGQnlNSEFnSTFNUWNDRkZUaHU0bHVhQ0JSZGVHNm8yNW5JRTVudzZOcERBY0NCbFRodTRsdWFBd01EQXdJQWdRQXdDMVNUQ3pHQ0F3TURBd01Cd0FIQUFiLy93VUhKQWNDQWpVeUJ3SVVWT0c3aVc1b0lFTERyRzVvSU1TUTRidUxibWdNQndJR1ZPRzdpVzVvREF3TURBZ0NCQURBTFZKTUxNWUlEQXdNREF3SEFBY0FCdi8vQlFjbEJ3SUNOVFFIQWhCVTRidUpibWdnVUdqRHVpQlp3NnB1REFjQ0JsVGh1NGx1YUF3TURBd0lBZ1FBd0MxU1RDekdDQXdNREF3TUJ3QUhBQWIvL3dVSEpnY0NBalUyQndJU1ZPRzdpVzVvSUV0b3c2RnVhQ0JJdzdKaERBY0NCbFRodTRsdWFBY0NBQXdNREFnQ0JBREFMVkpNTE1ZSURBd01EQXdIQUFjQUJ2Ly9CUWNuQndJQ05UZ0hBaE5VNGJ1SmJtZ2dUbWx1YUNCVWFIWGh1cTF1REFjQ0JsVGh1NGx1YUF3TURBd0lBZ1FBd0MxU1RDekdDQXdNREF3TUJ3QUhBQWIvL3dVSEtBY0NBall3QndJVVZPRzdpVzVvSUVMRHJHNW9JRlJvZGVHNnJXNE1Cd0lHVk9HN2lXNW9EQXdNREFnQ0JBREFMVkpNTE1ZSURBd01EQXdIQUFjQUJ2Ly9CUWNwQndJQ05qSUhBZzVVNGJ1SmJtZ2dTMjl1SUZSMWJRd0hBZ1pVNGJ1SmJtZ01EQXdNQ0FJRUFNQXRVa3dzeGdnTURBd01EQWNBQndBRy8vOEZCeW9IQWdJMk5BY0NEbFRodTRsdWFDQkhhV0VnVEdGcERBY0NCbFRodTRsdWFBd01EQXdJQWdRQXdDMVNUQ3pHQ0F3TURBd01Cd0FIQUFiLy93VUhLd2NDQWpZMkJ3SVRWT0c3aVc1b0lNU1E0YnF2YXlCTTRicXZhd3dIQWdaVTRidUpibWdNREF3TUNBSUVBTUF0VWt3c3hnZ01EQXdNREFjQUJ3QUcvLzhGQnl3SEFnSTJOd2NDRTFUaHU0bHVhQ0RFa09HNnIyc2dUc08wYm1jTUJ3SUdWT0c3aVc1b0RBd01EQWdDQkFEQUxWSk1MTVlJREF3TURBd0hBQWNBQnYvL0JRY3RCd0lDTmpnSEFoTlU0YnVKYm1nZ1RNT2liU0RFa09HN2syNW5EQWNDQmxUaHU0bHVhQXdNREF3SUFnUUF3QzFTVEN6R0NBd01EQXdNQndBSEFBYi8vd1VITGdjQ0FqY3dCd0lWVk9HN2lXNW9JRUxEckc1b0lGQm94ckRodTV0akRBY0NCbFRodTRsdWFBd01EQXdJQWdRQXdDMVNUQ3pHQ0F3TURBd01Cd0FIQUFiLy93VUhMd2NDQWpjeUJ3SVFWT0c3aVc1b0lGVERvbmtnVG1sdWFBd0hBZ1pVNGJ1SmJtZ01EQXdNQ0FJRUFNQXRVa3dzeGdnTURBd01EQWNBQndBRy8vOEZCekFIQWdJM05BY0NGRlRodTRsdWFDQkN3Nnh1YUNCRXhyREdvVzVuREFjQ0JsVGh1NGx1YUF3TURBd0lBZ1FBd0MxU1RDekdDQXdNREF3TUJ3QUhBQWIvL3dVSE1RY0NBamMxQndJU1ZPRzdpVzVvSU1TUTRidVRibWNnVG1GcERBY0NCbFRodTRsdWFBd01EQXdJQWdRQXdDMVNUQ3pHQ0F3TURBd01Cd0FIQUFiLy93VUhNZ2NDQWpjM0J3SWRWT0c3aVc1b0lFTERvQ0JTNGJ1TFlTQXRJRmJGcVc1bklGVERvSFVNQndJR1ZPRzdpVzVvREF3TURBZ0NCQURBTFZKTUxNWUlEQXdNREF3SEFBY0FCdi8vQlFjekJ3SUNOemtIQWh0VWFNT2dibWdnY0dqaHU1RWdTT0c3a3lCRGFNT3RJRTFwYm1nTUJ3SVpWR2pEb0c1b0lIQm80YnVSSUZSeWRXNW5JTWF3eHFGdVp3d01EQXdJQWdRQXdDMVNUQ3pHQ0F3TURBd01Cd0FIQUFiLy93VUhOQWNDQWpnd0J3SU9WT0c3aVc1b0lFeHZibWNnUVc0TUJ3SUdWT0c3aVc1b0RBd01EQWdDQkFEQUxWSk1MTVlJREF3TURBd0hBQWNBQnYvL0JRYzFCd0lDT0RJSEFoTlU0YnVKYm1nZ1ZHbmh1NEZ1SUVkcFlXNW5EQWNDQmxUaHU0bHVhQXdNREF3SUFnUUF3QzFTVEN6R0NBd01EQXdNQndBSEFBYi8vd1VITmdjQ0FqZ3pCd0lRVk9HN2lXNW9JRUxodXI5dUlGUnlaUXdIQWdaVTRidUpibWdNREF3TUNBSUVBTUF0VWt3c3hnZ01EQXdNREFjQUJ3QUcvLzhGQnpjSEFnSTROQWNDRUZUaHU0bHVhQ0JVY3NPZ0lGWnBibWdNQndJR1ZPRzdpVzVvREF3TURBZ0NCQURBTFZKTUxNWUlEQXdNREF3SEFBY0FCdi8vQlFjNEJ3SUNPRFlIQWhGVTRidUpibWdnVnNTcGJtZ2dURzl1Wnd3SEFnWlU0YnVKYm1nTURBd01DQUlFQU1BdFVrd3N4Z2dNREF3TURBY0FCd0FHLy84RkJ6a0hBZ0k0TndjQ0ZGVGh1NGx1YUNERWtPRzdrMjVuSUZSb3c2RndEQWNDQmxUaHU0bHVhQXdNREF3SUFnUUF3QzFTVEN6R0NBd01EQXdNQndBSEFBYi8vd1VIT2djQ0FqZzVCd0lQVk9HN2lXNW9JRUZ1SUVkcFlXNW5EQWNDQmxUaHU0bHVhQXdNREF3SUFnUUF3QzFTVEN6R0NBd01EQXdNQndBSEFBYi8vd1VIT3djQ0Fqa3hCd0lTVk9HN2lXNW9JRXRwdzZwdUlFZHBZVzVuREFjQ0JsVGh1NGx1YUF3TURBd0lBZ1FBd0MxU1RDekdDQXdNREF3TUJ3QUhBQWIvL3dVSFBBY0NBamt5QndJWFZHakRvRzVvSUhCbzRidVJJRVBodXFkdUlGUm94cUVNQndJWlZHakRvRzVvSUhCbzRidVJJRlJ5ZFc1bklNYXd4cUZ1Wnd3TURBd0lBZ1FBd0MxU1RDekdDQXdNREF3TUJ3QUhBQWIvL3dVSFBRY0NBamt6QndJU1ZPRzdpVzVvSUVqaHVxMTFJRWRwWVc1bkRBY0NCbFRodTRsdWFBd01EQXdJQWdRQXdDMVNUQ3pHQ0F3TURBd01Cd0FIQUFiLy93VUhQZ2NDQWprMEJ3SVNWT0c3aVc1b0lGUERzMk1nVkhMRWcyNW5EQWNDQmxUaHU0bHVhQXdNREF3SUFnUUF3QzFTVEN6R0NBd01EQXdNQndBSEFBYi8vd1VIUHdjQ0FqazFCd0lTVk9HN2lXNW9JRUxodXFGaklFeHB3NnAxREFjQ0JsVGh1NGx1YUF3TURBd0lBZ1FBd0MxU1RDekdDQXdNREF3TUJ3QUhBQWIvL3dVSFFBY0NBamsyQndJT1ZPRzdpVzVvSUVQRG9DQk5ZWFVNQndJR1ZPRzdpVzVvREF3TURBZ0NCQURBTFZKTUxNWUlEQXdNREF3PR4FU3RhdGUFlAFCdzhIQUFJQkJ3RUNBUWNDQWdFSEF3SUJCd1FDQUFjRUFnQUhCQUlBQndRQ0FBY0VBZ0FIQkFJQUJ3UUNBQWNFQWdBSEJBSUFCd1FDQUFjRUFnQUhBQWNBQndBSEFBSUJCd0FGQndFQ0MwbEVYM0J5YjNacGJtTmxDUUlBQWdBREJ3UUNBQWNBQWdFSEFBSUJCd0E9',
			'ctl00$PlaceHolderMain$grid2$DXSelInput' => '',
			'ctl00$PlaceHolderMain$grid2$DXFocusedRowInput' => '-1',
			'ctl00$PlaceHolderMain$grid2$CallbackState' => '/wEWBB4ERGF0YQUoQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQWNBQndBPR4FU3RhdGUFnAFCeEVIQUFJQkJ3RUNBUWNDQWdFSEF3SUJCd1FDQVFjRkFnRUhCZ0lBQndZQ0FBY0dBZ0FIQmdJQUJ3WUNBQWNHQWdBSEJnSUFCd1lDQUFjR0FnQUhCZ0lBQndZQ0FBY0FCd0FIQUFjQUFnRUcvLzhKQWd0SlJGOUVhWE4wY21samRBa0NBQUlBQXdjRUFnQUhBQUlCQndBQ0FRY0E=',
			'ctl00$PlaceHolderMain$grid3$DXSelInput' => '',
			'ctl00$PlaceHolderMain$grid3$DXFocusedRowInput' => '-1',
			'ctl00$PlaceHolderMain$grid3$CallbackState' => '/wEWBB4ERGF0YQUoQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQWNBQndBPR4FU3RhdGUFqAFCeE1IQUFJQkJ3RUNBUWNDQWdFSEF3SUJCd1FDQVFjRkFnRUhCZ0lCQndjQ0FRY0lBZ0FIQ0FJQUJ3Z0NBQWNJQWdBSENBSUFCd2dDQUFjSUFnQUhDQUlBQndnQ0FBY0lBZ0FIQ0FJQUJ3QUhBQWNBQndBQ0FRYi8vd2tDQ2tsRVgwTnZiVzExYm1VSkFnQUNBQU1IQkFJQUJ3QUNBUWNBQWdFSEFBPT0=',
			'ctl00$PlaceHolderMain$ASPxGridView4$DXSelInput' => '',
			'ctl00$PlaceHolderMain$ASPxGridView4$CallbackState' => '/wEWBB4ERGF0YQUoQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQWNBQndBPR4FU3RhdGUFYEJ3Z0hBQUlCQndFQ0FRY0NBZ0VIQXdJQkJ3UUNBUWNGQWdFSEJnSUJCd2NDQVFjQUJ3QUhBQWNBQWdBRy8vOEpBZ0FKQWdBQ0FBTUhCQUlBQndBQ0FRY0FBZ0VIQUE9PQ==',
			'ctl00$PlaceHolderMain$ASPxGridView5$DXSelInput' => '',
			'ctl00$PlaceHolderMain$ASPxGridView5$CallbackState' => '/wEWBB4ERGF0YQUoQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQWNBQndBPR4FU3RhdGUFYEJ3Z0hBQUlCQndFQ0FRY0NBZ0VIQXdJQkJ3UUNBUWNGQWdFSEJnSUJCd2NDQVFjQUJ3QUhBQWNBQWdBRy8vOEpBZ0FKQWdBQ0FBTUhCQUlBQndBQ0FRY0FBZ0VIQUE9PQ==',
			'ctl00$PlaceHolderMain$ASPxGridView6$DXSelInput' => '',
			'ctl00$PlaceHolderMain$ASPxGridView6$CallbackState' => '/wEWBB4ERGF0YQUoQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQWNBQndBPR4FU3RhdGUFWEJ3Y0hBQUlCQndFQ0FRY0NBZ0VIQXdJQkJ3UUNBUWNGQWdFSENnSUFCd0FIQUFjQUJ3QUNBQWIvL3drQ0FBa0NBQUlBQXdjRUFnQUhBQUlCQndBQ0FRY0E=',
		);

		return $form_data;
	}

	protected function download_xls($data) {
		$headers =
		$headers[] = 'Connection: keep-alive';
		$headers[] = 'Cache-Control: max-age=0';
		$headers[] = 'Upgrade-Insecure-Requests: 1';
		$headers[] = 'Origin: https://www.gso.gov.vn';
		$headers[] = 'Content-Type: application/x-www-form-urlencoded';
		$headers[] = 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36';
		$headers[] = 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9';
		$headers[] = 'Sec-Fetch-Site: same-origin';
		$headers[] = 'Sec-Fetch-Mode: navigate';
		$headers[] = 'Sec-Fetch-User: ?1';
		$headers[] = 'Sec-Fetch-Dest: document';
		$headers[] = 'Referer: ' . Diagioihanhchinh_Common::ADMINISTRATIVE_BOUNDARIES_URL;
		$headers[] = 'Accept-Language: en-US,en;q=0.9,vi;q=0.8';

		$response = Requests::request(
			Diagioihanhchinh_Common::ADMINISTRATIVE_BOUNDARIES_URL,
			$headers,
			$data,
			'POST',
			array(
				'verify' => false,
				'connect_timeout' => 10000,
				'timeout' => 10000,
			)
		);
		if (!$response->success) {
			return false;
		}

		return $response->body;
	}

	protected function fetch_data($output_xls) {
		$response = Requests::request(
			Diagioihanhchinh_Common::ADMINISTRATIVE_BOUNDARIES_URL,
			array(),
			array(),
			'GET',
			array(
				'verify' => false,
			)
		);
		if (!$response->success) {
			Logger::get('diagioihanhchinh')->error(sprintf(
				'Can not fetch data from "%s"',
				Diagioihanhchinh_Common::ADMINISTRATIVE_BOUNDARIES_URL
			));
			return false;
		}
		$data = $this->build_form_data($response->body);
		$xls = $this->download_xls($data);

		$output = fopen($output_xls, 'w');
		@fwrite($output, $xls);

		// Close temporary file
		@fclose($output_xls);
	}

	public function read_xls() {


		return $output_xls;
	}


	public function fetch() {
		$output_xls = sprintf('%s/outputs/data.xls', dirname(DIAGIOIHANHCHINH_PLUGIN_FILE));
		if (!file_exists($output_xls)) {
			$output_xls = $this->fetch_data($output_xls);
		}

		if (false === $output_xls) {
			return false;
		}

		$reader = new Xls();
		$spreadsheet = $reader->load($output_xls);

		return $spreadsheet;
	}
}
